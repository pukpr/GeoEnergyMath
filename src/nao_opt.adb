with System.Task_Info;
with GEM.LTE.Primitives.Solution;
with GEM.LTE.Primitives.Shared;
with Text_IO;
procedure NAO_Opt is
   N :  Positive := System.Task_Info.Number_Of_Processors;

   LT : constant GEM.LTE.Modulations := (
   (2.763168894,	4.782646953,	-1.531748603),
   (42.38703079, 	4.206881588,	-5.741140747),
   (18.68216048, 	3.581731279,	-4.376886727),
   (144.0, 0.001,	1.0),
   (320.0, 0.001,	1.0)
                                );

   D : GEM.LTE.Primitives.Shared.Param_S :=
        (NLP    => GEM.LTE.LP'Length,
         NLT    => LT'Length,
         LP     => GEM.LTE.LP,
         LT     => LT,
         Offset => -0.002770852,
         bg     => 0.037589404,
         ImpA   => 13.57577452, -- 0.0,
         ImpB   => -7.056004563, -- 1.22,
         ImpC   => 20.25515663, -- 1.399,
         ImpD   => -16.59027049, -- 1.2149,
         mA     => 0.080599014,
         mP     => -0.008405309,
         mD     => -0.0021993,
         shiftT => 0.000001,
         fB     => -0.022004419, -- 10.761,
         fC     => 1.469665629, -- 11.865,
         fA     => 0.600532903, -- 7.55161
         k0     => 0.169,
         level  => 0.0,
         init   => 0.0063);


  begin
   Text_IO.Put_Line(N'Img & " processors available");
   -- GEM.Setenv("CLIMATE_INDEX", "nao.txt");
   GEM.Setenv("IMPA", "9");  -- these are 6-months earlier than 9 & 10
   GEM.Setenv("IMPB", "6");
   GEM.Setenv("IMPC", "3");  -- these are 6-months earlier than 9 & 10
   GEM.Setenv("IMPD", "0");
   GEM.LTE.Primitives.Shared.Load(D); -- if available
   GEM.LTE.Primitives.Shared.Put(D);
   GEM.LTE.Primitives.Solution.Start(D.NLP, D.NLT, N);
   for I in 1..Integer'Last loop
      -- delay 1.0;
      -- The call to Status is blocking
      if I mod 100 =0 then
         Text_IO.Put_Line(GEM.LTE.Primitives.Solution.Status & " #" & I'Img);
      end if;
      exit when GEM.LTE.Primitives.Halted;
   end loop;
   Text_IO.Put_Line("Main exiting, flushing other tasks");
   delay 5.0;

end NAO_Opt;

--    -0.00265223109,
--     0.05778311493,
--    13.53807606113,
--    -7.03295225537,
--    20.19425556429,
--   -16.71749969689,
--     0.08321367314,
--    -0.00841625311,
--    -0.00219491781,
--     0.00000294182,
--    -0.02082995840,
--     1.47038723038,
--     0.59976336468,
--     0.00938816717,
--     0.00000000000,
--    -0.00000000000,

--   182.62323100000,
--     0.01803758709,
--    -2.02646235848,
--   365.24646200000,
--     0.01875624565,
--     1.57587660916,
--    31.81209136000,
--    -0.00133354993,
--    -0.55130824900,
--    27.66676713000,
--     0.01930801250,
--     3.66809324914,
--    13.77727494000,
--     0.02087700956,
--     0.01627619011,
--    13.60611041000,
--    -0.02797749191,
--    -1.35767367792,
--    13.66083077000,
--     0.18799356818,
--    -2.82241590760,
--    27.21222082000,
--     0.00042673503,
--     0.45748582550,
--    27.55454988000,
--    -0.04792546038,
--    -1.38636984719,
--    27.32166155000,
--     0.00032914871,
--     1.29299936192,
--    13.63341568000,
--     0.06116645968,
--    -1.97396840119,
--     7.09581061500,
--    -0.04698304459,
--    -3.39550941883,
--     6.85940288400,
--    -0.02434851650,
--   -17.61005848720,
--     9.55688740100,
--     0.01343319589,
--    -7.38730419643,
--     9.13295078100,
--    -0.00649433534,
--    -0.02792505800,
--     9.12456635500,
--     0.00803113038,
--    -0.01752320120,
--    14.76532679000,
--    -0.01711419527,
--    -2.49455016858,
--    27.09267692000,
--     0.01400466557,
--     7.32069051655,

--     2.67791871524,
--     0.37890194416,
--    -2.51716739871,
--    42.34282487193,
--     1.33731462048,
--    -5.80844380665,
--    18.62271866295,
--     0.61294975280,
--    -3.50770783713,
--   144.62458696837,
--     1.08245176160,
--    -0.53781794407,
--   221.54241384115,
--     1.63215367842,
--     4.73691534294,
--  CC=   0.72112008   0.00000000   5 1
--
